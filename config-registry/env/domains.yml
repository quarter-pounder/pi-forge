# Active domains and their deployment characteristics
# This is the declarative source of truth for domain modelling

domains:
  - name: forgejo
    description: Forgejo code hosting service
    placement: tunnel
    standalone: false
    requires:
      - postgres
    exposes_to:
      - tunnel
      - monitoring
      - woodpecker
      - registry
    consumes:
      - postgres
    networks:
      - forgejo-network

  - name: postgres
    description: PostgreSQL backing database for Forgejo and Woodpecker
    placement: local
    standalone: true
    requires: []
    exposes_to:
      - forgejo
      - woodpecker
    consumes: []
    networks:
      - forgejo-network

  - name: woodpecker
    description: Woodpecker CI server
    placement: tunnel
    standalone: false
    requires:
      - postgres
      - forgejo
    exposes_to:
      - tunnel
      - monitoring
    consumes:
      - forgejo
      - postgres
    networks:
      - forgejo-network

  - name: woodpecker-runner
    description: Woodpecker Docker runner
    placement: local
    standalone: false
    requires:
      - woodpecker
      - forgejo
    exposes_to: []
    consumes:
      - woodpecker
      - forgejo
    networks:
      - forgejo-network

  - name: monitoring
    description: Prometheus, Grafana, Loki
    placement: local
    standalone: true
    requires: []
    exposes_to:
      - tunnel
    consumes:
      - forgejo
      - woodpecker

  - name: adblocker
    description: Pi-hole + Unbound DNS filtering
    placement: local
    standalone: true
    requires: []
    exposes_to:
      - tunnel
    consumes: []

  - name: tunnel
    description: Cloudflare connector providing external ingress
    placement: external
    standalone: true
    requires: []
    exposes_to:
      - forgejo
      - woodpecker
      - registry
      - adblocker
    consumes: []
    managed_externally: true

  - name: registry
    description: Container registry exposed via Forgejo
    placement: tunnel
    standalone: false
    requires:
      - forgejo
    exposes_to:
      - tunnel
      - forgejo
    consumes:
      - forgejo
    networks:
      - registry-network
      - forgejo-network

  - name: forgejo-actions-runner
    description: Forgejo Actions runner for executing GitHub Actions-compatible workflows
    placement: local
    standalone: false
    requires:
      - forgejo
    exposes_to: []
    consumes:
      - forgejo
    networks:
      - forgejo-network

  - name: github-actions-runner
    description: GitHub Actions self-hosted runner for executing workflows
    placement: local
    standalone: true
    requires: []
    exposes_to: []
    consumes: []
    networks:
      - github-actions-runner-network

